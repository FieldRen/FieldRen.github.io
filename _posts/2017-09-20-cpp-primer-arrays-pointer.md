---
layout: post
titile: 【C++Primer】之数组和指针
date: 2017-09-20 22:36:00
published: true
categories: C++
tags: C++
---
# 数组

数组是一种复合类型[1]。数组的大小确定不变，不能随意向数组中增加元素。因为数组的大小固定，因此对于某些特殊的应用来说程序的运行时性能较好，但是相应地也损失了一些灵活性。

如果不清楚元素的确切个数，请使用vector。

<!--more-->

## 数组的声明

数组的声明形如`a[d]`, 其中`a`是数组的名字，`d`是数组的维度，在编译的时候维度应该是已知的。也就是说，**维度必须是一个常量表达式**。

```C++
int arr[10];                 //含有10个整数的数组
unsigned cnt = 42;           //不是常量表达式
constexpr unsigned sz = 42;  //常量表达式，关于constexpr请看[2]
int *parr[sz];               //含有42个整形指针的数组
string bad[cnt];             //错误：cnt不是常量表达式
```
## 显式初始化数组元素

可以对数组的元素进行列表初始化，此时允许忽略数组的维度。如果在声明时没有指明维度，编译器会根据初始值的数量计算并推测出来；相反，如果指明了维度，那么初始值的总数量不应该超过维度所指定的大小。**如果维度大于初始值数量，则用提供的初始值初始化靠前的元素，剩下的元素被初始化成默认值**[3]

```C++
const unsigned sz = 3;
int ia1[sz] = {0,1,2};     //含有三个元素的数组，元素值分别是0，1，2
int a2[]={0,1,2};          //维度是3的数组
int a3[5]={0,1,2};         //等价于a3[]={0,1,2,0,0}
string a4[3]={"hi","bye"}; //等价于a4[]={"hi","bye",""}
int a5[2]={0,1,2};         //错误：初始值过多
```
+ 声明数组时，可以不指定维度，初始化时编译器根据初始值推测维度
+ 数组初始化时，初始值的个数不能大于指定的维度
+ 数组初始化时，若初始值的个数小于指定的维度，则后面的元素将执行默认初始化

## 字符数组的特殊性

字符数组由一种额外的初始化形式，我们可以用字符串字面值[4]对此类数组初始化。注意：**字符串字面值的结尾处还有一个空字符，这个空字符也会像字符串的其他字符一样被拷贝到字符数组中去**

```C++
char a1[] = {'C','+','+'};        //列表初始化，没有空字符
char a2[] = {'C','+','+','\0'};   //列表初始化，含有显式的空字符
char a3[] = "C++";                //自动添加表示字符串结束的空字符
const char a4[6] = "Daniel";      //错误：没有空间可存放空字符
```
a1的维度是3，a2、a3的维度是4，a4的初始化元素个数超过了指定的维度。

## 不允许拷贝和赋值

**不能将数组的内容拷贝给其他数组作为其初始值，也不能用数组为其他数组赋值**



----
[1]复合类型（compound type）：基于其它类型定义的类型，比如引用、指针和数组都属于复合类型。

[2]常量表达式（const expression）：是指值不会改变并且在编译过程就能得到计算结果的表达式。字面值属于常量表达式，比如1，2，3...。一个对象（或表达式）是不是常量表达式是由它的 **数据类型** 和 **初始值** 共同决定。const对象不一定是常量表达式，**用常量表达式初始化的const对象才是常量表达式。** 在一个复杂系统中，很难（几乎肯定不能）分辨一个初始值到底是不是常量表达式。C++11新标准规定，允许将变量申明为`constexpr`类型以便由编译器来验证变量的值是否是一个常量表达式。申明为`constexpr`的变量一定是一个常量，而且必须用常量表达式初始化。

[3]如果vector对象的元素是内置类型，比如int,则元素初始值自动设为0。如果元素是某种类类型，比如string, 则元素由类默认初始化。

[4]由单引号括起来的一个字符称为char型字面值，双引号括起来的零个或者多个字符则构成字符串型字面值。字符串字面值的类型实际上是由常量字符构成的数组（array）。编译器在每个字符串的结尾处添加一个空字符('\0'),因此字符串字面值的实际长度要比它的内容多1。
